!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s){e(this,"_hasInvalidInput",(e=>e.some((e=>!e.validity.valid)))),e(this,"_toggleButtonState",(()=>{this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0),this._buttonElement.setAttribute("style","cursor:not-allowed")):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"),this._buttonElement.setAttribute("style","cursor: pointer"))})),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._formElement=s,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector("#".concat(e.id,"-error"));s.textContent=t,s.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setInputsEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setInputsEventListeners()}}class s{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popupElement=document.querySelector(e)}open(){this._popupElement.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_active")||e.target.classList.contains("popup__exit-icon"))&&this.close()}))}}class i extends s{constructor(e,t){super(e),this._formPopupElement=this._popupElement.querySelector(".popup__form"),this._submitBtn=this._formPopupElement.querySelector(".popup__form-submit-btn"),this._inputList=this._formPopupElement.querySelectorAll(".popup__form-input"),this._submitHandler=t,this._initialText=this._submitBtn.textContent}getInputValues(){const e={};return this._inputList.forEach((t=>{const s=t.name;e[s]=t.value})),e}setEventListeners(){super.setEventListeners(),this._formPopupElement.addEventListener("submit",(e=>{e.preventDefault(),this.renderLoading(!0),this._submitHandler()}))}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";e?(this._submitBtn.diabled=!0,this._submitBtn.textContent=t,this._submitBtn.setAttribute("style","cursor:not-allowed")):(this._submitBtn.diabled=!1,this._submitBtn.textContent=this._initialText,this._submitBtn.setAttribute("style","cursor:pointer"))}getBtn(){return this._submitBtn}close(){super.close(),this._formPopupElement.reset()}}const n=".elements__list",r=".profile__name",o=".profile__role",l=(document.querySelector(n),document.querySelector(".profile__edit-btn")),a=document.querySelector(".profile__add-btn"),c=document.querySelector("#inputName"),h=document.querySelector("#inputRole"),_=(document.querySelector(r),document.querySelector(o),document.querySelector(".elements__likesNumber"),document.querySelector(".profile__imageContainer"));document.querySelector(".profile__image");class u{constructor(e,t,s){let{likedBolVal:i,ownerId:n,text:r,image:o,id:l,likesNum:a,handleCardClick:c,openDeleteConfirmPopUp:h,handleLike:_,handleDeleteLike:u}=e;this._text=r,this._image=o,this._templateSelector=t,this._handleCardClick=c,this._openDeleteConfirmPopUp=h,this._element=this._getTemplate(),this._imageItem=this._element.querySelector(".elements__image"),this._textItem=this._element.querySelector(".elements__text"),this._deleteItem=this._element.querySelector(".elements__delete-icon"),this._likeNumberItem=this._element.querySelector(".elements__likesNumber"),this._likeItem=this._element.querySelector(".elements__like-btn"),this._id=l,this._userId=s,this._ownerId=n,this._likesNum=a,this._likedBolVal=i,this._handleLike=_,this._handleDeleteLike=u}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".elements__element").cloneNode(!0)}generateCard(){return this._imageItem.src=this._image,this._textItem.textContent=this._text,this._imageItem.alt="view of ".concat(this._text),this._likeNumberItem.textContent=this._likesNum,this.setEventListeners(),this._likedBolVal&&this.toggleLikeButton(),this._userId!==this._ownerId&&this._deleteItem.setAttribute("style","display:none"),this._element}setEventListeners(){this._imageItem.addEventListener("click",(()=>{this._handleCardClick()})),this._likeItem.addEventListener("click",(()=>{this._likeItem.classList.contains("elements__svg-heart_liked")?this._handleDeleteLike(this):this._handleLike(this)})),this._deleteItem.addEventListener("click",(()=>{this.openDeleteConfirmPopUp()}))}openDeleteConfirmPopUp(){this._openDeleteConfirmPopUp(this._id)}deleteDomCard(){this._element.remove()}getId(){return this._id}toggleLikeButton(){this._likeItem.classList.toggle("elements__svg-heart_liked")}updateLikes(e){this._likeNumberItem.textContent=e}}const d=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._checkResponse)}postNewCard(e,t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}confirmDelete(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}deleteLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._checkResponse)}editUserInfo(e){let{form__name:t,form__role:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then(this._checkResponse)}editAvatarImage(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject("Error ".concat(e.status))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"d117ca4c-01ef-4f19-abee-387b4e32e69d","Content-Type":"application/json"}}),m=new class{constructor(e,t){let{data:s,renderer:i}=e;this._container=document.querySelector(t),this._items=s,this._renderer=i}renderer(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({data:[],renderer:e=>{m.addItem(cardRenderer(e))}},n),p=new i("#addImage",(function(){const e=p.getInputValues(),t=e.form__title,s=e.form__imageLink,i={};i.name=t,i.link=s,d.postNewCard(t,s).then((e=>{i.ownerId=e.owner._id,i._id=e._id,i.likes=e.likes,m.addItem(L(i)),p.close()})).catch(console.log).finally((()=>{p.renderLoading(!1)}))})),f=new i("#editProfileImage",(function(){const e=f.getInputValues().form__imageLink;d.editAvatarImage(e).then((e=>{f.close(),v.setUserInfo(e)})).catch((e=>{console.log(e)})).finally((()=>{f.renderLoading(!1)}))})),g=new i("#editProfile",(function(){const e=g.getInputValues();d.editUserInfo(e).then((e=>{g.close(),v.setUserInfo(e)})).catch(console.log).finally((()=>{g.renderLoading(!1)}))})),b=new class extends s{constructor(e){super(e),this._formPopupElement=this._popupElement.querySelector(".popup__form")}deleteAction(e){this._submitHandler=e}setEventListeners(){super.setEventListeners(),this._formPopupElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()}))}}("#confirmDelete"),E=new class extends s{constructor(e){var t,s;super(e),s=(e,t)=>{this._imageFile.src=e,this._imageText.textContent=t,this._imageFile.alt="view of ".concat(t),super.open()},(t="open")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this.open=s,this._imageFile=this._popupElement.querySelector(".popup__imagePopUp"),this._imageText=this._popupElement.querySelector(".popup__imagePopUp-text")}}("#imagePopUp"),v=new class{constructor(e){let{nameSelector:t,roleSelector:s,avatarSelector:i,userId:n}=e;this._profileName=document.querySelector(t),this._profileRole=document.querySelector(s),this._avatarImage=document.querySelector(i)}getUserInfo(){const e={};return e.name=this._profileName.textContent,e.role=this._profileRole.textContent,e}setUserInfo(e){this._profileName.textContent=e.name,this._profileRole.textContent=e.about,this._avatarImage.src=e.avatar}}({nameSelector:r,roleSelector:o,avatarSelector:".profile__image"}),k={};var I;I={inputSelector:".popup__form-input",submitButtonSelector:".popup__form-submit-btn",inactiveButtonClass:"popup__form-submit-btn_inactive",inputErrorClass:"popup__form-errorMsg",errorClass:"popup__form-errorMsg_active",formSelector:".popup__form"},Array.from(document.querySelectorAll(I.formSelector)).forEach((e=>{const s=new t(I,e),i=e.getAttribute("name");k[i]=s,s.enableValidation()})),g.setEventListeners(),p.setEventListeners(),f.setEventListeners(),b.setEventListeners(),E.setEventListeners();const L=e=>{const t=e.ownerId?e.ownerId:e.owner._id,s=e.name,i=e.link;let n=e.likes.length;const r=e._id;let o=!1;e.likes.forEach((e=>{if(e._id===y)return o=!0,o}));const l=new u({likedBolVal:o,ownerId:t,text:s,image:i,id:r,likesNum:n,handleCardClick:()=>{(e=>{e.open(i,s)})(E)},openDeleteConfirmPopUp:e=>{b.open(),b.deleteAction((()=>{d.confirmDelete(e).then((e=>{l.deleteDomCard(),b.close()})).catch(console.log)}))},handleLike:e=>{!function(e){d.likeCard(e.getId()).then((t=>{e.updateLikes(t.likes.length),e.toggleLikeButton()})).catch((e=>{console.log(e)}))}(e)},handleDeleteLike:e=>{!function(e){d.deleteLike(e.getId()).then((t=>{e.updateLikes(t.likes.length),e.toggleLikeButton()})).catch((e=>{console.log(e)}))}(e)}},"#card-template",y);return l.generateCard()};let y;Promise.all([d.getUserInfo(),d.getInitialCards()]).then((e=>{let[t,s]=e;y=t._id,Array.from(s).forEach((e=>{m.addItem(L(e))})),v.setUserInfo(t)})).catch(console.log),l.addEventListener("click",(()=>{k.edit__form.resetValidation();const e=v.getUserInfo();c.setAttribute("value",e.name),h.setAttribute("value",e.role),g.open()})),a.addEventListener("click",(()=>{k.add__form.resetValidation(),p.open()})),_.addEventListener("click",(()=>{k.editProfileImage__form.resetValidation(),f.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RTdCeEIsRUFBZ0JDLFlBQVl5QixNQUU3Qi9CLE1BQU1DLFFBQVFDLEtBK0VqQnBHLEVBQWV4QyxpQkFBaUIsU0FBUyxLQUN2Q2dLLEVBQWMsV0FBZTlKLGtCQUM3QixNQUFNNEosRUFBV2YsRUFBZ0JyQyxjQUNqQ2hFLEVBQVVyRSxhQUFhLFFBQVN5TCxFQUFTakksTUFDekNjLEVBQVV0RSxhQUFhLFFBQVN5TCxFQUFTQyxNQUN6Q2IsRUFBVXRJLFVBR1o2QixFQUFjekMsaUJBQWlCLFNBQVMsS0FDdENnSyxFQUFjLFVBQWM5SixrQkFDNUJrSSxFQUFTeEgsVUFHWGdDLEVBQWlCNUMsaUJBQWlCLFNBQVMsS0FDekNnSyxFQUFjLHVCQUEyQjlKLGtCQUN6QzRJLEVBQW9CbEksVSIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZS9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiY3Vyc29yOm5vdC1hbGxvd2VkXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiY3Vyc29yOiBwb2ludGVyXCIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIF9zZXRJbnB1dHNFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldElucHV0c0V2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfYWN0aXZlXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX2FjdGl2ZVwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9hY3RpdmVcIikgfHxcclxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fZXhpdC1pY29uXCIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBzdWJtaXRIYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Zvcm1Qb3B1cEVsZW1lbnQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ0biA9IHRoaXMuX2Zvcm1Qb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIucG9wdXBfX2Zvcm0tc3VibWl0LWJ0blwiXHJcbiAgICApO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID1cclxuICAgICAgdGhpcy5fZm9ybVBvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19mb3JtLWlucHV0XCIpO1xyXG4gICAgdGhpcy5fc3VibWl0SGFuZGxlciA9IHN1Ym1pdEhhbmRsZXI7XHJcbiAgICB0aGlzLl9pbml0aWFsVGV4dCA9IHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudDtcclxuICB9XHJcblxyXG4gIGdldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRGaWVsZHMgPSB7fTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBjb25zdCBrZXkgPSBpbnB1dC5uYW1lO1xyXG4gICAgICBpbnB1dEZpZWxkc1trZXldID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBpbnB1dEZpZWxkcztcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2Zvcm1Qb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBcclxuICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgbG9hZGluZ1RleHQ9J1NhdmluZy4uLicpIHtcclxuICAgIGlmIChpc0xvYWRpbmcpIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuLmRpYWJsZWQgPSB0cnVlO1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiY3Vyc29yOm5vdC1hbGxvd2VkXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuLmRpYWJsZWQgPSBmYWxzZTtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuLnRleHRDb250ZW50ID0gdGhpcy5faW5pdGlhbFRleHQ7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImN1cnNvcjpwb2ludGVyXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0QnRuKCl7XHJcbiAgICByZXR1cm4gdGhpcy5fc3VibWl0QnRuO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybVBvcHVwRWxlbWVudC5yZXNldCgpO1xyXG4gIH1cclxufVxyXG4iLCJjb25zdCBpbWFnZVBvcHVwU2VsZWN0b3IgPSBcIiNpbWFnZVBvcFVwXCI7XHJcbmNvbnN0IGdhbGxlcnlTZWxlY3RvciA9IFwiLmVsZW1lbnRzX19saXN0XCI7XHJcbmNvbnN0IG5hbWVTZWxlY3RvciA9IFwiLnByb2ZpbGVfX25hbWVcIjtcclxuY29uc3Qgcm9sZVNlbGVjdG9yID0gXCIucHJvZmlsZV9fcm9sZVwiO1xyXG5jb25zdCBhdmF0YXJTZWxlY3RvciA9IFwiLnByb2ZpbGVfX2ltYWdlXCI7XHJcbmNvbnN0IGNhcmRzRWxlbWVudHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihnYWxsZXJ5U2VsZWN0b3IpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbmNvbnN0IHByb2ZpbGVBZGRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XHJcbmNvbnN0IGlucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXROYW1lXCIpO1xyXG5jb25zdCBpbnB1dFJvbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um9sZVwiKTtcclxuY29uc3QgdXNlck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbmNvbnN0IHVzZXJSb2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihyb2xlU2VsZWN0b3IpO1xyXG5jb25zdCBsaWtlc051bUl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19saWtlc051bWJlclwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VDb250YWluZXJcIik7XHJcbmNvbnN0IHByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XHJcblxyXG5jb25zdCBzZXR0aW5ncyA9IHtcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1zdWJtaXQtYnRuXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fZm9ybS1zdWJtaXQtYnRuX2luYWN0aXZlXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19mb3JtLWVycm9yTXNnXCIsXHJcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZm9ybS1lcnJvck1zZ19hY3RpdmVcIixcclxuICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXHJcbn07XHJcblxyXG5leHBvcnQge1xyXG4gIHJvbGVTZWxlY3RvcixcclxuICBuYW1lU2VsZWN0b3IsXHJcbiAgYXZhdGFyU2VsZWN0b3IsXHJcbiAgaW5wdXROYW1lLFxyXG4gIGlucHV0Um9sZSxcclxuICBsaWtlc051bUl0ZW0sXHJcbiAgZWRpdFByb2ZpbGVJbWFnZSxcclxuICBzZXR0aW5ncyxcclxuICBnYWxsZXJ5U2VsZWN0b3IsXHJcbiAgdXNlck5hbWUsXHJcbiAgdXNlclJvbGUsXHJcbiAgcHJvZmlsZUltYWdlLFxyXG4gIHByb2ZpbGVBZGRCdG4sXHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgY2FyZHNFbGVtZW50c0xpc3QsXHJcbiAgaW1hZ2VQb3B1cFNlbGVjdG9yLFxyXG59O1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3Rvcih7IGxpa2VkQm9sVmFsLCBvd25lcklkLCB0ZXh0LCBpbWFnZSwgaWQsIGxpa2VzTnVtLCBoYW5kbGVDYXJkQ2xpY2ssIG9wZW5EZWxldGVDb25maXJtUG9wVXAsIGhhbmRsZUxpa2UsIGhhbmRsZURlbGV0ZUxpa2V9LCB0ZW1wbGF0ZVNlbGVjdG9yLCB1c2VySWQpIHtcclxuICAgIHRoaXMuX3RleHQgPSB0ZXh0O1xyXG4gICAgdGhpcy5faW1hZ2UgPSBpbWFnZTtcclxuICAgIHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IgPSB0ZW1wbGF0ZVNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5fb3BlbkRlbGV0ZUNvbmZpcm1Qb3BVcCA9IG9wZW5EZWxldGVDb25maXJtUG9wVXA7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgIHRoaXMuX2ltYWdlSXRlbSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50c19faW1hZ2VcIik7XHJcbiAgICB0aGlzLl90ZXh0SXRlbSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50c19fdGV4dFwiKTtcclxuICAgIHRoaXMuX2RlbGV0ZUl0ZW0gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2RlbGV0ZS1pY29uXCIpO1xyXG4gICAgdGhpcy5fbGlrZU51bWJlckl0ZW0gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2xpa2VzTnVtYmVyXCIpO1xyXG4gICAgdGhpcy5fbGlrZUl0ZW0gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2xpa2UtYnRuXCIpO1xyXG4gICAgdGhpcy5faWQgPSBpZDtcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuICAgIHRoaXMuX293bmVySWQgPSBvd25lcklkO1xyXG4gICAgdGhpcy5fbGlrZXNOdW0gPSBsaWtlc051bTtcclxuICAgIHRoaXMuX2xpa2VkQm9sVmFsID0gbGlrZWRCb2xWYWw7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlID0gaGFuZGxlTGlrZTtcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUxpa2UgPSBoYW5kbGVEZWxldGVMaWtlO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl90ZW1wbGF0ZVNlbGVjdG9yKVxyXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19lbGVtZW50XCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9pbWFnZUl0ZW0uc3JjID0gdGhpcy5faW1hZ2U7XHJcbiAgICB0aGlzLl90ZXh0SXRlbS50ZXh0Q29udGVudCA9IHRoaXMuX3RleHQ7XHJcbiAgICB0aGlzLl9pbWFnZUl0ZW0uYWx0ID0gYHZpZXcgb2YgJHt0aGlzLl90ZXh0fWA7XHJcbiAgICB0aGlzLl9saWtlTnVtYmVySXRlbS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzTnVtO1xyXG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fbGlrZWRCb2xWYWwgPyB0aGlzLnRvZ2dsZUxpa2VCdXR0b24oKSA6IG51bGw7XHJcbiAgICB0aGlzLl91c2VySWQgPT09IHRoaXMuX293bmVySWQgPyBudWxsIDogXHJcbiAgICB0aGlzLl9kZWxldGVJdGVtLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsXCJkaXNwbGF5Om5vbmVcIik7IFxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2ltYWdlSXRlbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2xpa2VJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2xpa2VJdGVtLmNsYXNzTGlzdC5jb250YWlucyhcImVsZW1lbnRzX19zdmctaGVhcnRfbGlrZWRcIikgXHJcbiAgICAgID8gdGhpcy5faGFuZGxlRGVsZXRlTGlrZSh0aGlzKVxyXG4gICAgICA6IHRoaXMuX2hhbmRsZUxpa2UodGhpcylcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2RlbGV0ZUl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5vcGVuRGVsZXRlQ29uZmlybVBvcFVwKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9wZW5EZWxldGVDb25maXJtUG9wVXAoKSB7XHJcbiAgICB0aGlzLl9vcGVuRGVsZXRlQ29uZmlybVBvcFVwKHRoaXMuX2lkKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZURvbUNhcmQoKXtcclxuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgfVxyXG5cclxuICBnZXRJZCgpe1xyXG4gICAgcmV0dXJuIHRoaXMuX2lkO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlTGlrZUJ1dHRvbigpe1xyXG4gICAgdGhpcy5fbGlrZUl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShcImVsZW1lbnRzX19zdmctaGVhcnRfbGlrZWRcIik7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVMaWtlcyhsaWtlc0NvdW50KXtcclxuICAgIHRoaXMuX2xpa2VOdW1iZXJJdGVtLnRleHRDb250ZW50ID0gbGlrZXNDb3VudDtcclxuICB9XHJcbn1cclxuXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7IGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICB9XHJcblxyXG4gIHBvc3ROZXdDYXJkKG5hbWUsIGxpbmspIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gIH1cclxuXHJcbiAgY29uZmlybURlbGV0ZShjYXJkSWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgfVxyXG5cclxuICBkZWxldGVMaWtlKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICB9XHJcblxyXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwgeyBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckluZm8oeyBmb3JtX19uYW1lLCBmb3JtX19yb2xlIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiBmb3JtX19uYW1lLFxyXG4gICAgICAgIGFib3V0OiBmb3JtX19yb2xlLFxyXG4gICAgICB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgfVxyXG5cclxuICBlZGl0QXZhdGFySW1hZ2UoaW1hZ2VMaW5rKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogaW1hZ2VMaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgfVxyXG5cclxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImQxMTdjYTRjLTAxZWYtNGYxOS1hYmVlLTM4N2I0ZTMyZTY5ZFwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aFN1Ym1pdCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanNcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgc2V0dGluZ3MsXHJcbiAgZWRpdFByb2ZpbGVJbWFnZSxcclxuICBuYW1lU2VsZWN0b3IsXHJcbiAgcm9sZVNlbGVjdG9yLFxyXG4gIGF2YXRhclNlbGVjdG9yLFxyXG4gIHByb2ZpbGVBZGRCdG4sXHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgcHJvZmlsZUltYWdlLFxyXG4gIGltYWdlUG9wdXBTZWxlY3RvcixcclxuICBnYWxsZXJ5U2VsZWN0b3IsXHJcbiAgdXNlck5hbWUsXHJcbiAgdXNlclJvbGUsXHJcbiAgaW5wdXROYW1lLFxyXG4gIGlucHV0Um9sZSxcclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCB7IGFwaSB9IGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5cclxuY29uc3QgZ2FsbGVyeSA9IG5ldyBTZWN0aW9uKFxyXG4gIHtcclxuICAgIGRhdGE6IFtdLFxyXG4gICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XHJcbiAgICAgIGdhbGxlcnkuYWRkSXRlbShjYXJkUmVuZGVyZXIoaXRlbSkpO1xyXG4gICAgfSxcclxuICB9LFxyXG4gIGdhbGxlcnlTZWxlY3RvclxyXG4pO1xyXG5cclxuY29uc3QgYWRkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNhZGRJbWFnZVwiLCBoYW5kbGVDYXJkRm9ybVN1Ym1pdCk7XHJcbmNvbnN0IGVkaXRQcm9maWxlSW1nUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNlZGl0UHJvZmlsZUltYWdlXCIsXHJcbiAgaGFuZGxlRWRpdFByb2ZpbGVJbWFnZVxyXG4pO1xyXG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNlZGl0UHJvZmlsZVwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbmNvbnN0IGNvbmZpcm1EZWxldGVQb3BVcCA9IG5ldyBQb3B1cFdpdGhTdWJtaXQoXCIjY29uZmlybURlbGV0ZVwiKTtcclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShpbWFnZVBvcHVwU2VsZWN0b3IpO1xyXG5jb25zdCBwcm9maWxlVXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcixcclxuICByb2xlU2VsZWN0b3IsXHJcbiAgYXZhdGFyU2VsZWN0b3IsXHJcbn0pO1xyXG5cclxuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fTtcclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChzZXR0aW5ncykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmZvcm1TZWxlY3RvcikpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcbiAgICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpO1xyXG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpO1xyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yO1xyXG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG5lZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYWRkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuZWRpdFByb2ZpbGVJbWdQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5jb25maXJtRGVsZXRlUG9wVXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuaW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgY3JlYXRlQ2FyZCA9IChpdGVtKSA9PiB7XHJcbiAgY29uc3Qgb3duZXJJZCA9IGl0ZW0ub3duZXJJZCA/IGl0ZW0ub3duZXJJZCA6IGl0ZW0ub3duZXIuX2lkO1xyXG4gIGNvbnN0IHRleHQgPSBpdGVtLm5hbWU7XHJcbiAgY29uc3QgaW1hZ2UgPSBpdGVtLmxpbms7XHJcbiAgbGV0IGxpa2VzTnVtID0gaXRlbS5saWtlcy5sZW5ndGg7XHJcbiAgY29uc3QgaWQgPSBpdGVtLl9pZDtcclxuICBsZXQgbGlrZWRCb2xWYWwgPSBmYWxzZTtcclxuICBpdGVtLmxpa2VzLmZvckVhY2goKHVzZXIpID0+IHtcclxuICAgIGlmICh1c2VyLl9pZCA9PT0gdXNlcklkKSB7XHJcbiAgICAgIGxpa2VkQm9sVmFsID0gdHJ1ZTtcclxuICAgICAgcmV0dXJuIGxpa2VkQm9sVmFsO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBoYW5kbGVDYXJkQ2xpY2sgPSAoaW1hZ2VQb3B1cCkgPT4ge1xyXG4gICAgaW1hZ2VQb3B1cC5vcGVuKGltYWdlLCB0ZXh0KTtcclxuICB9O1xyXG4gIFxyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIHtcclxuICAgICAgbGlrZWRCb2xWYWwsXHJcbiAgICAgIG93bmVySWQsXHJcbiAgICAgIHRleHQsXHJcbiAgICAgIGltYWdlLFxyXG4gICAgICBpZCxcclxuICAgICAgbGlrZXNOdW0sXHJcbiAgICAgIGhhbmRsZUNhcmRDbGljazogKCkgPT4ge1xyXG4gICAgICAgIGhhbmRsZUNhcmRDbGljayhpbWFnZVBvcHVwKTtcclxuICAgICAgfSxcclxuICAgICAgb3BlbkRlbGV0ZUNvbmZpcm1Qb3BVcDogKGlkKSA9PiB7XHJcbiAgICAgICAgY29uZmlybURlbGV0ZVBvcFVwLm9wZW4oKTtcclxuICAgICAgICBjb25maXJtRGVsZXRlUG9wVXAuZGVsZXRlQWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgIGFwaVxyXG4gICAgICAgICAgICAuY29uZmlybURlbGV0ZShpZClcclxuICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgIGNhcmQuZGVsZXRlRG9tQ2FyZCgpO1xyXG4gICAgICAgICAgICAgIGNvbmZpcm1EZWxldGVQb3BVcC5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICBoYW5kbGVMaWtlOiAoY2FyZCkgPT4ge1xyXG4gICAgICAgIGhhbmRsZUxpa2UoY2FyZCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGhhbmRsZURlbGV0ZUxpa2U6IChjYXJkKSA9PiB7XHJcbiAgICAgICAgaGFuZGxlRGVsZXRlTGlrZShjYXJkKTtcclxuICAgICAgfSxcclxuICAgIH0sXHJcblxyXG4gICAgXCIjY2FyZC10ZW1wbGF0ZVwiLFxyXG4gICAgdXNlcklkXHJcbiAgKTtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59O1xyXG5cclxubGV0IHVzZXJJZDtcclxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxyXG4gIC50aGVuKChbcmVzVXNlciwgcmVzQ2FyZHNdKSA9PiB7XHJcbiAgICB1c2VySWQgPSByZXNVc2VyLl9pZDtcclxuICAgIGNvbnN0IGNhcmRzID0gQXJyYXkuZnJvbShyZXNDYXJkcyk7XHJcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgIGdhbGxlcnkuYWRkSXRlbShjcmVhdGVDYXJkKGNhcmQpKTtcclxuICAgIH0pO1xyXG4gICAgcHJvZmlsZVVzZXJJbmZvLnNldFVzZXJJbmZvKHJlc1VzZXIpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KCkge1xyXG4gIGNvbnN0IGlucHV0RmllbGRzID0gZWRpdFBvcHVwLmdldElucHV0VmFsdWVzKCk7XHJcbiAgYXBpXHJcbiAgICAuZWRpdFVzZXJJbmZvKGlucHV0RmllbGRzKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBlZGl0UG9wdXAuY2xvc2UoKTtcclxuICAgICAgcHJvZmlsZVVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBlZGl0UG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZEZvcm1TdWJtaXQoKSB7XHJcbiAgY29uc3QgaW5wdXRGaWVsZHMgPSBhZGRQb3B1cC5nZXRJbnB1dFZhbHVlcygpO1xyXG4gIGNvbnN0IHRleHQgPSBpbnB1dEZpZWxkcy5mb3JtX190aXRsZTtcclxuICBjb25zdCBpbWFnZSA9IGlucHV0RmllbGRzLmZvcm1fX2ltYWdlTGluaztcclxuICBjb25zdCBpdGVtID0ge307XHJcbiAgaXRlbS5uYW1lID0gdGV4dDtcclxuICBpdGVtLmxpbmsgPSBpbWFnZTtcclxuICBhcGlcclxuICAgIC5wb3N0TmV3Q2FyZCh0ZXh0LCBpbWFnZSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaXRlbS5vd25lcklkID0gcmVzLm93bmVyLl9pZDtcclxuICAgICAgaXRlbS5faWQgPSByZXMuX2lkO1xyXG4gICAgICBpdGVtLmxpa2VzID0gcmVzLmxpa2VzO1xyXG4gICAgICBnYWxsZXJ5LmFkZEl0ZW0oY3JlYXRlQ2FyZChpdGVtKSk7XHJcbiAgICAgIGFkZFBvcHVwLmNsb3NlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBhZGRQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVkaXRQcm9maWxlSW1hZ2UoKSB7XHJcbiAgY29uc3QgaW5wdXRMaW5rRmllbGQgPSBlZGl0UHJvZmlsZUltZ1BvcHVwLmdldElucHV0VmFsdWVzKCk7XHJcbiAgY29uc3QgbGluayA9IGlucHV0TGlua0ZpZWxkLmZvcm1fX2ltYWdlTGluaztcclxuICBhcGlcclxuICAgIC5lZGl0QXZhdGFySW1hZ2UobGluaylcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgZWRpdFByb2ZpbGVJbWdQb3B1cC5jbG9zZSgpO1xyXG4gICAgICBwcm9maWxlVXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgZWRpdFByb2ZpbGVJbWdQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVMaWtlKGNhcmQpIHtcclxuICBhcGlcclxuICAgIC5saWtlQ2FyZChjYXJkLmdldElkKCkpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGNhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzLmxlbmd0aCk7XHJcbiAgICAgIGNhcmQudG9nZ2xlTGlrZUJ1dHRvbigpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlTGlrZShjYXJkKSB7XHJcbiAgYXBpXHJcbiAgICAuZGVsZXRlTGlrZShjYXJkLmdldElkKCkpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGNhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzLmxlbmd0aCk7XHJcbiAgICAgIGNhcmQudG9nZ2xlTGlrZUJ1dHRvbigpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBmb3JtVmFsaWRhdG9yc1tcImVkaXRfX2Zvcm1cIl0ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgY29uc3QgdXNlckRhdGEgPSBwcm9maWxlVXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBpbnB1dE5hbWUuc2V0QXR0cmlidXRlKFwidmFsdWVcIiwgdXNlckRhdGEubmFtZSk7XHJcbiAgaW5wdXRSb2xlLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIHVzZXJEYXRhLnJvbGUpO1xyXG4gIGVkaXRQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUFkZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGZvcm1WYWxpZGF0b3JzW1wiYWRkX19mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGFkZFBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG5lZGl0UHJvZmlsZUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZm9ybVZhbGlkYXRvcnNbXCJlZGl0UHJvZmlsZUltYWdlX19mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGVkaXRQcm9maWxlSW1nUG9wdXAub3BlbigpO1xyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBkYXRhLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGRhdGE7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyZXIoKSB7XHJcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIGFkZEl0ZW0oaXRlbSkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoU3VibWl0IGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fZm9ybVBvcHVwRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlQWN0aW9uKGFjdGlvbil7XHJcbiAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybVBvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IoaW1hZ2VQb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcihpbWFnZVBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faW1hZ2VGaWxlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlUG9wVXBcIik7XHJcbiAgICB0aGlzLl9pbWFnZVRleHQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIucG9wdXBfX2ltYWdlUG9wVXAtdGV4dFwiXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgb3BlbiA9IChpbWFnZSwgdGV4dCkgPT4ge1xyXG4gICAgdGhpcy5faW1hZ2VGaWxlLnNyYyA9IGltYWdlO1xyXG4gICAgdGhpcy5faW1hZ2VUZXh0LnRleHRDb250ZW50ID0gdGV4dDtcclxuICAgIHRoaXMuX2ltYWdlRmlsZS5hbHQgPSBgdmlldyBvZiAke3RleHR9YDtcclxuICAgIHN1cGVyLm9wZW4oKTtcclxuICB9O1xyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgcm9sZVNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciwgdXNlcklkIH0pIHtcclxuICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fcHJvZmlsZVJvbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHJvbGVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9hdmF0YXJJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICBjb25zdCB1c2VyRGF0YSA9IHt9O1xyXG4gICAgdXNlckRhdGEubmFtZSA9IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gICAgdXNlckRhdGEucm9sZSA9IHRoaXMuX3Byb2ZpbGVSb2xlLnRleHRDb250ZW50O1xyXG4gICAgcmV0dXJuIHVzZXJEYXRhO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oZGF0YSkge1xyXG4gICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9wcm9maWxlUm9sZS50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XHJcbiAgICB0aGlzLl9hdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJpbnB1dExpc3QiLCJzb21lIiwiaW5wdXRFbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsInRoaXMiLCJfaGFzSW52YWxpZElucHV0IiwiX2lucHV0TGlzdCIsIl9idXR0b25FbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInF1ZXJ5U2VsZWN0b3IiLCJfc2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsInRleHRDb250ZW50IiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldElucHV0c0V2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJyZXNldFZhbGlkYXRpb24iLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJrZXkiLCJjbG9zZSIsIl9wb3B1cEVsZW1lbnQiLCJkb2N1bWVudCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwic3VibWl0SGFuZGxlciIsInN1cGVyIiwiX2Zvcm1Qb3B1cEVsZW1lbnQiLCJfc3VibWl0QnRuIiwiX3N1Ym1pdEhhbmRsZXIiLCJfaW5pdGlhbFRleHQiLCJnZXRJbnB1dFZhbHVlcyIsImlucHV0RmllbGRzIiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwibG9hZGluZ1RleHQiLCJkaWFibGVkIiwiZ2V0QnRuIiwicmVzZXQiLCJnYWxsZXJ5U2VsZWN0b3IiLCJuYW1lU2VsZWN0b3IiLCJyb2xlU2VsZWN0b3IiLCJwcm9maWxlRWRpdEJ0biIsInByb2ZpbGVBZGRCdG4iLCJpbnB1dE5hbWUiLCJpbnB1dFJvbGUiLCJlZGl0UHJvZmlsZUltYWdlIiwiQ2FyZCIsInRlbXBsYXRlU2VsZWN0b3IiLCJ1c2VySWQiLCJsaWtlZEJvbFZhbCIsIm93bmVySWQiLCJ0ZXh0IiwiaW1hZ2UiLCJsaWtlc051bSIsImhhbmRsZUNhcmRDbGljayIsIm9wZW5EZWxldGVDb25maXJtUG9wVXAiLCJoYW5kbGVMaWtlIiwiaGFuZGxlRGVsZXRlTGlrZSIsIl90ZXh0IiwiX2ltYWdlIiwiX3RlbXBsYXRlU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX29wZW5EZWxldGVDb25maXJtUG9wVXAiLCJfZWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsIl9pbWFnZUl0ZW0iLCJfdGV4dEl0ZW0iLCJfZGVsZXRlSXRlbSIsIl9saWtlTnVtYmVySXRlbSIsIl9saWtlSXRlbSIsIl9pZCIsIl91c2VySWQiLCJfb3duZXJJZCIsIl9saWtlc051bSIsIl9saWtlZEJvbFZhbCIsIl9oYW5kbGVMaWtlIiwiX2hhbmRsZURlbGV0ZUxpa2UiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwic3JjIiwiYWx0IiwidG9nZ2xlTGlrZUJ1dHRvbiIsImRlbGV0ZURvbUNhcmQiLCJnZXRJZCIsInRvZ2dsZSIsInVwZGF0ZUxpa2VzIiwibGlrZXNDb3VudCIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsIl9jaGVja1Jlc3BvbnNlIiwicG9zdE5ld0NhcmQiLCJsaW5rIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25maXJtRGVsZXRlIiwiY2FyZElkIiwiZGVsZXRlTGlrZSIsImxpa2VDYXJkIiwiZ2V0VXNlckluZm8iLCJlZGl0VXNlckluZm8iLCJmb3JtX19uYW1lIiwiZm9ybV9fcm9sZSIsImFib3V0IiwiZWRpdEF2YXRhckltYWdlIiwiaW1hZ2VMaW5rIiwiYXZhdGFyIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImF1dGhvcml6YXRpb24iLCJnYWxsZXJ5IiwiY29udGFpbmVyU2VsZWN0b3IiLCJkYXRhIiwicmVuZGVyZXIiLCJfY29udGFpbmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiaXRlbSIsImFkZEl0ZW0iLCJwcmVwZW5kIiwiY2FyZFJlbmRlcmVyIiwiYWRkUG9wdXAiLCJmb3JtX190aXRsZSIsImZvcm1fX2ltYWdlTGluayIsIm93bmVyIiwibGlrZXMiLCJjcmVhdGVDYXJkIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwiZmluYWxseSIsImVkaXRQcm9maWxlSW1nUG9wdXAiLCJwcm9maWxlVXNlckluZm8iLCJzZXRVc2VySW5mbyIsImVyciIsImVkaXRQb3B1cCIsImNvbmZpcm1EZWxldGVQb3BVcCIsImRlbGV0ZUFjdGlvbiIsImFjdGlvbiIsImltYWdlUG9wdXAiLCJpbWFnZVBvcHVwU2VsZWN0b3IiLCJfaW1hZ2VGaWxlIiwiX2ltYWdlVGV4dCIsImF2YXRhclNlbGVjdG9yIiwiX3Byb2ZpbGVOYW1lIiwiX3Byb2ZpbGVSb2xlIiwiX2F2YXRhckltYWdlIiwidXNlckRhdGEiLCJyb2xlIiwiZm9ybVZhbGlkYXRvcnMiLCJmb3JtU2VsZWN0b3IiLCJ2YWxpZGF0b3IiLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZSIsImxlbmd0aCIsInVzZXIiLCJjYXJkIiwiYWxsIiwicmVzVXNlciIsInJlc0NhcmRzIl0sInNvdXJjZVJvb3QiOiIifQ==